#!/bin/bash

# some globally accesible variables
barlog="$HOME/.local/lemonbarlog"
fifofile="$HOME/.local/dzenfifo"
# Functions for all
getwifiname() {
	Tico=" "
	# wifi essid
	T=$(iwconfig "wlp8s0" | grep -i essid \
		| awk '{print $NF}' | \
		sed -e  "s/://g; s/ESSID//g; s/\"//g")
	# output to stdin
	echo -e "${Tico}${T} "
}
getdatevalue() {
	Tico=" "
	# date value
	echo -e "${Tico}$(date '+%Y-%m-%d %H:%M')"
}
getbatteryinfo() {
	BAT="/sys/class/power_supply/BAT0"
	capacity=$(cat "${BAT}/capacity")
	status=$(cat "${BAT}/status")
	# icons
	Tico=" "
	[ "$status"="Discharging" ] && {
	case $capacity in
		[0-9])
			Tico=" "
			;;
		[1-2]*)
			Tico=" "
			;;
		[3-6]*)
			Tico=" "
			;;
		[7-9]*)
			Tico=" "
			;;
		[100])
			Tico=" "
			;;
	esac
	}
	# spit out info
	echo -e "${Tico}${capacity}% "
}
getvolumeinfo() {
	#aout=$(amixer get Master)
	#state=$(echo $aout | grep -P 'Front Right:' | grep -Po 'off')
	#perc=$(echo $aout | grep -P 'Front Right:' | grep -Po '\d{2,3}\%')
	##if [ -n "$state" ]
	##then
		 ##echo ""
	##else
		 #echo " $perc $state"
	##fi
	#pulseaudio --start && {
	echo " $(amixer get Master | sed -n 'N;s/^.*\[\([0-9]\+%\).*$/\1/p') "
	#}
}
getworkspaces() {
	blackmagic() {
		# do some things
		case $1 in
			[ou]*)
				X=$(echo -e "$1" | sed -e "s/[ou]//g")
					echo -e "$Y($X)$Y"
				;;
			[OU]*)
				X=$(echo -e "$1" | sed -e "s/[OU]//g")
					echo -e "$Y[$X]$Y"
				;;
			f*)
				X=$(echo -e "$1" | sed -e "s/f//g")
					echo -e "$Y$X$Y"
				;;
			F*)
				X=$(echo -e "$1" | sed -e "s/F//g")
					echo -e "$Y$X$Y"
				;;
			[WwMm]*)
				;;
		esac
	}

	# the goods
	bspstat=$(bspc wm -g | sed -e "s/:/ /g")
	# the text
	Y=" "
	yabarstat=""
	# the trips
	for ID in $bspstat; do
		yabarstat="$yabarstat$(blackmagic $ID)"
	done
	echo "$yabarstat"
}
printinfo() { 
	echo "$(getwifiname) $(getvolumeinfo) $(getbatteryinfo) $(getdatevalue)" | sed -e "s/$//g"
} 
printinfo 2> /dev/null
